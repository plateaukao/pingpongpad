<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8" />
      <title>SocketIO example</title>
      <style>
      html,
body {
  height: 100%;
  padding: 0;
  margin: 0;
}

div {
  width: 50%;
  height: 40%;
  float: left;
  text-align: right;
}

#div_up_left {
  background: #DDD;
}

#div_up_right {
}

#div_bottom_left {
}

#div_bottom_right {
  background: #DDD;
}
      
      </style>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function(){

           var elapsedTimeIntervalRef
           var start_time = new Date();
           var socket = io.connect();
           socket.on('status_response', function(msg) {
               var date = new Date();
               $('#total_balls').text(msg.total_balls);
               $('#total_hits').text(msg.total_hits);
               $('#cont_hits').text(msg.cont_hits);
               $('#max_cont_hits').text(msg.max_cont_hits);
           });

            const tracking = document.getElementById('tracking');
            tracking.addEventListener('click', async _ => {
               try {     
                  if($('#tracking').text() == 'Tracking!') {
                     socket.emit("tracking");
                     $('#tracking').text('Stop!')
                     start_time = new Date();
                     elapsedTimeIntervalRef = setInterval(() => { updateDuration(start_time); }, 1000);
                  } else {
                     socket.emit("stop");
                     $('#tracking').text('Tracking!')
                     clearInterval(elapsedTimeIntervalRef);
                  }
               } catch(err) {
                  console.error(`Error: ${err}`);
               }
            });

            const test_camera = document.getElementById('test_camera');
            test_camera.addEventListener('click', async _ => {
               try {     
                  if($('#test_camera').text() == 'Testing Camera!') {
                     socket.emit("test_camera");
                     $('#test_camera').text('Recording...')
                  } else {
                     socket.emit("stop");
                     $('#test_camera').text('Testing Camera!')
                  }
               } catch(err) {
                  console.error(`Error: ${err}`);
               }
            });

            function updateDuration(startTime) {
               let endTime = new Date();
               let timeDiff = (endTime.getTime() - startTime.getTime()) / 1000;
               let seconds = Math.floor(timeDiff % 60);
               let minutes = Math.floor(timeDiff / 60);
               $('#duration').text(zeroPad(minutes, 2) + ":" + zeroPad(seconds, 2));
            }

            function zeroPad(num, places) {
               var zero = places - num.toString().length + 1;
              return Array(+(zero > 0 && zero)).join("0") + num;
            }
        });
    </script>
   </head>
   <body>
    <div id="div_up_left"><h1 id="total_balls" align="right">0</h1>total balls</div>
    <div id="div_up_right"><h1 id="total_hits" align="right">0</h1>total hits</div>
    <div id="div_bottom_left"><h1 id="cont_hits" align="right" sytle="color:red">0</h1>continuous</div>
    <div id="div_bottom_right"><h1 id="max_cont_hits" align="right">0</h1>max continous</div>
    <div><h1 id="duration">00:00</h1></div>
    <button type="button" id="test_camera">Testing Camera!</button>
    <button type="button" id="tracking">Tracking!</button>
   </body>
</html>
